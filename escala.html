<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Escala Mensal</title>

<style>
/* === SEU VISUAL (INALTERADO) === */
:root{
  --amarelo:#F4C430;
  --preto:#1a1a1a;
  --cinza:#2a2a2a;
  --borda:#444;
  --folga:#f6d7c3;
}

*{ box-sizing:border-box; }

body{
  background:var(--preto);
  color:#fff;
  font-family:Arial, Helvetica, sans-serif;
  padding:10px;
}

.topo{
  display:flex;
  align-items:center;
  justify-content:space-between;
  margin-bottom:10px;
}

h1{
  color:var(--amarelo);
  font-size:18px;
  margin:0;
}

.voltar{
  background:var(--amarelo);
  color:#000;
  padding:6px 12px;
  border-radius:6px;
  font-size:12px;
  font-weight:bold;
  text-decoration:none;
}

table{
  width:100%;
  border-collapse:collapse;
  table-layout:fixed;
  margin-bottom:14px;
}

th, td{
  border:1px solid var(--borda);
  padding:3px 2px;
  font-size:10.5px;
  text-align:center;
  vertical-align:middle;
}

th{
  background:var(--amarelo);
  color:#000;
}

.nome{
  width:65px;
  font-weight:bold;
  background:#111;
}

.folga{
  background:var(--folga);
  color:#000;
  font-weight:bold;
}

.obs{
  text-align:center;
  font-size:11px;
  opacity:.7;
}
</style>
</head>

<body>

<div class="topo">
  <h1 id="titulo"></h1>
  <a href="index.html" class="voltar">‚¨Ö Voltar</a>
</div>

<div id="calendario"></div>

<div class="obs">ESCALA SUJEITA A ALTERA√á√ïES</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getFirestore,
  doc,
  setDoc,
  getDoc
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* üî• FIREBASE CONFIG (O MESMO DOS RELAT√ìRIOS) */
const firebaseConfig = {
  apiKey: "AIzaSyB4fG9rCJq2nUAWgu_wpCxCy8zLUvziBIA",
  authDomain: "biergarten-f5756.firebaseapp.com",
  projectId: "biergarten-f5756",
  storageBucket: "biergarten-f5756.firebasestorage.app",
  messagingSenderId: "391344176716",
  appId: "1:391344176716:web:db69d2b7d99fca2a377ee9"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* üîó disponibiliza para o outro script */
window.db = db;
window.doc = doc;
window.setDoc = setDoc;
window.getDoc = getDoc;
</script>


<script>
/* === DATA ATUAL (BRASIL) === */
const hoje = new Date();
const ano = hoje.getFullYear();
const mes = hoje.getMonth();

const nomeMes = hoje.toLocaleString("pt-BR", { month: "long" }).toUpperCase();
document.getElementById("titulo").innerText = `ESCALA MENSAL ‚Äì ${nomeMes}`;

/* === FUNCION√ÅRIOS === */
const funcionarios = ["Samuel", "Alisson", "Larissa", "Daniel"];

/* === MODELO SEMANAL (HOR√ÅRIOS FIXOS) === */
const modelo = {
  Samuel:{
    seg:"FOLGA", ter:"11:00 - 14:00 / 18:00 - 23:00",
    qua:"11:00 - 14:00 / 18:00 - 23:00",
    qui:"11:00 - 14:00 / 18:00 - 23:00",
    sex:"11:00 - 14:00 / 18:00 - 23:00",
    sab:"11:00 - 14:00 / 18:00 - 23:00",
    dom:"-"
  },
  Alisson:{
    seg:"15:30 - 18:00 / 19:00 - 23:30",
    ter:"12:00 - 15:30 / 18:00 - 23:00",
    qua:"FOLGA",
    qui:"15:30 - 18:00 / 19:00 - 23:30",
    sex:"15:30 - 17:00 / 18:00 - 00:30",
    sab:"15:30 - 18:00 / 19:00 - 23:30",
    dom:"-"
  },
  Larissa:{
    seg:"09:30 - 11:00 / 12:00 - 18:00",
    ter:"FOLGA",
    qua:"09:30 - 11:00 / 12:00 - 18:00",
    qui:"09:30 - 11:00 / 12:00 - 18:00",
    sex:"09:30 - 11:00 / 12:00 - 18:00",
    sab:"09:30 - 11:00 / 12:00 - 18:00",
    dom:"-"
  },
  Daniel:{
    seg:"11:00 - 14:00 / 18:00 - 23:00",
    ter:"15:30 - 18:00 / 19:00 - 23:30",
    qua:"15:30 - 18:00 / 19:00 - 23:30",
    qui:"FOLGA",
    sex:"15:30 - 17:00 / 18:00 - 00:30",
    sab:"13:30 - 15:00 / 18:00 - 23:30",
    dom:"-"
  }
};

const diasSemana = ["dom","seg","ter","qua","qui","sex","sab"];

/* === GERAR CALEND√ÅRIO === */
function gerarCalendario(){
  const container = document.getElementById("calendario");
  container.innerHTML = "";

  const totalDias = new Date(ano, mes+1, 0).getDate();
  let semana = [];

  for(let d=1; d<=totalDias; d++){
    semana.push(d);

    if(semana.length === 7 || d === totalDias){
      montarTabela(semana);
      semana = [];
    }
  }
}


function montarTabela(dias){
  let html = `<table><tr><th>Nome</th>`;
  dias.forEach(d=>{
    const data = new Date(ano, mes, d);
    const diaSemana = data.toLocaleString("pt-BR",{weekday:"long"});
    html += `<th>${diaSemana}<br>${String(d).padStart(2,"0")}/${String(mes+1).padStart(2,"0")}</th>`;
  });
  html += `</tr>`;

  funcionarios.forEach(nome=>{
    html += `<tr><td class="nome">${nome}</td>`;
    dias.forEach(d=>{
      const data = new Date(ano, mes, d);
      const ds = diasSemana[data.getDay()];
      const valor = modelo[nome][ds] || "-";
      const classe = valor === "FOLGA" ? "folga" : "";
      const dataISO = `${ano}-${String(mes+1).padStart(2,"0")}-${String(d).padStart(2,"0")}`;
html += `<td class="${classe}" data-nome="${nome}" data-data="${dataISO}">${valor}</td>`;

    });
    html += `</tr>`;
  });

  html += `</table>`;
  document.getElementById("calendario").innerHTML += html;
}

gerarCalendario();
carregarEscalaFirebase();


async function carregarEscalaFirebase(){
  const mesDoc = `${ano}-${String(mes+1).padStart(2,"0")}`;
  const snap = await getDoc(doc(db, "escala", mesDoc));
  if (!snap.exists()) return;

  const dados = snap.data();

  document.querySelectorAll("td[data-nome]").forEach(td=>{
    const nome = td.dataset.nome;
    const data = td.dataset.data;

    if (dados[data] && dados[data][nome]) {
      td.innerText = dados[data][nome];
      if (dados[data][nome] === "FOLGA") {
        td.classList.add("folga");
      }
    }
  });
}


// ===== EDI√á√ÉO COM SENHA (ADMIN) =====
const SENHA_ADMIN = "1234"; // troque depois

document.addEventListener("click", function (e) {
  const cell = e.target;

  // s√≥ permite editar TD que n√£o seja nome
  if (cell.tagName !== "TD") return;
  if (cell.classList.contains("nome")) return;

  const textoAtual = cell.innerText.trim();
  if (!textoAtual) return;

  const senha = prompt("Senha do administrador:");
  if (senha !== SENHA_ADMIN) {
    alert("Senha incorreta");
    return;
  }

  const novoValor = prompt(
    "Digite o novo hor√°rio ou FOLGA:",
    textoAtual
  );

  if (novoValor === null) return;

  cell.innerText = novoValor.toUpperCase();

  // üî• SALVAR NO FIREBASE
const nome = cell.dataset.nome;
const data = cell.dataset.data;
const mesDoc = `${ano}-${String(mes+1).padStart(2,"0")}`;

if (nome && data) {
  setDoc(
    doc(db, "escala", mesDoc),
    {
      [data]: {
        [nome]: novoValor.toUpperCase()
      }
    },
    { merge: true }
  );
}


  if (novoValor.toUpperCase().includes("FOLGA")) {
    cell.classList.add("folga");
  } else {
    cell.classList.remove("folga");
  }
});

</script>



</body>
</html>
