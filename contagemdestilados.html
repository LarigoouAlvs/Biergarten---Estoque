// ðŸ“Š EXPORTAR CSV + WHATSAPP
document.getElementById("exportar").onclick = () => {
  let csv = "Item;Minimo (Doses);Estoque (Doses);Bar (Doses);Pedido (Doses);Sugestao Garrafas\n";

  itens.forEach(item => {
    const minimoDoses = item.minimoGarrafas * item.dosesPorGarrafa;
    const totalDoses = estado[item.nome].estoque + estado[item.nome].bar;
    const pedidoDoses = Math.max(minimoDoses - totalDoses, 0);
    const sugestaoGarrafas = (pedidoDoses / item.dosesPorGarrafa).toFixed(1);

    csv += `${item.nome};${minimoDoses};${estado[item.nome].estoque};${estado[item.nome].bar};${pedidoDoses};${sugestaoGarrafas}\n`;
  });

  const blob = new Blob(["\ufeff" + csv], { type: "text/csv;charset=utf-8;" });
  const url = URL.createObjectURL(blob);

  const data = new Date().toLocaleDateString().replace(/\//g, "-");
  const nomeArquivo = `contagem_destilados_${data}.csv`;

  // â¬‡ï¸ Download automÃ¡tico
  const link = document.createElement("a");
  link.href = url;
  link.download = nomeArquivo;
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);

  // ðŸ“² Adicionando um delay antes de abrir o WhatsApp
  setTimeout(() => {
    const telefoneWhats = "554796086328"; // +55 47 9608-6328
    const mensagem = encodeURIComponent(
      `Segue a contagem de DESTILADOS (${data}).\nArquivo: ${nomeArquivo}`
    );

    window.open(
      `https://wa.me/${telefoneWhats}?text=${mensagem}`,
      "_blank"
    );
  }, 2000); // 2000ms (2 segundos) de delay
};
