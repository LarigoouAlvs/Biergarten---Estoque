<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Biergarten | Relat√≥rios</title>

<!-- jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
:root {
  --amarelo: #F4C430;
  --preto: #1a1a1a;
  --preto80: #262626;
}

body {
  font-family: Arial, sans-serif;
  background: var(--preto);
  color: #fff;
  margin: 0;
  padding: 20px;
}

.topo {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}

h1 {
  color: var(--amarelo);
  margin: 0;
}

a.voltar {
  color: #000;
  background: var(--amarelo);
  padding: 8px 12px;
  border-radius: 6px;
  text-decoration: none;
  font-weight: bold;
}

.acoes {
  display: flex;
  gap: 10px;
  margin-bottom: 20px;
}

input, button {
  padding: 10px;
  border-radius: 6px;
  border: none;
  font-weight: bold;
}

button {
  background: var(--amarelo);
  cursor: pointer;
}

.registro {
  background: var(--preto80);
  border-left: 6px solid var(--amarelo);
  padding: 12px;
  margin-bottom: 10px;
  border-radius: 6px;
  display: flex;
  justify-content: space-between;
}

.lixeira {
  background: none;
  border: none;
  color: #ff4d4d;
  font-size: 18px;
  cursor: pointer;
}
</style>
</head>

<body>

<div class="topo">
  <h1>üç∫ Biergarten ‚Äî Relat√≥rios</h1>
  <a href="index.html" class="voltar">‚¨Ö Voltar</a>
</div>

<div class="acoes">
  <input type="month" id="mes">
  <button id="btnPdf">üìÑ Exportar PDF</button>
</div>

<div id="lista"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getFirestore,
  collection,
  addDoc
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* üîß CONFIG FIREBASE */
const firebaseConfig = {
  apiKey: "AIzaSyB4fG9rCJq2nUAWgu_wpCxCy8zLUvziBIA",
  authDomain: "biergarten-f5756.firebaseapp.com",
  projectId: "biergarten-f5756",
  storageBucket: "biergarten-f5756.firebasestorage.app",
  messagingSenderId: "391344176716",
  appId: "1:391344176716:web:db69d2b7d99fca2a377ee9"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* üì¶ PRODUTOS */
const produtos = [
  "Coca-Cola",
  "Coca Zero",
  "Fanta",
  "Sprite",
  "Red Bull",
  "Stella",
  "Stella Gold",
  "√Ågua sem g√°s",
  "√Ågua com g√°s"
];

/* üß† ESTADO */
let selecionados = JSON.parse(localStorage.getItem("temporario")) || [];

/* üîó ELEMENTOS */
const lista = document.getElementById("lista");
const busca = document.getElementById("busca");
const resumo = document.getElementById("resumo");
const itens = document.getElementById("itens");
const tipo = document.getElementById("tipo");
const colaborador = document.getElementById("colaborador");
const finalizar = document.getElementById("finalizar");

/* üñ•Ô∏è RENDER */
function render(filtro = "") {
  lista.innerHTML = "";

  produtos
    .filter(p => p.toLowerCase().includes(filtro.toLowerCase()))
    .forEach(produto => {
      const qtd = selecionados.find(i => i.produto === produto)?.quantidade || 0;

      const div = document.createElement("div");
      div.className = "produto";
      div.innerHTML = `
        <span>${produto}</span>
        <div class="botoes">
          <button onclick="add('${produto}',1)">+1</button>
          <button onclick="add('${produto}',6)">+6</button>
          <button onclick="add('${produto}',12)">+12</button>
          <span class="contador">${qtd}</span>
        </div>
      `;
      lista.appendChild(div);
    });
}

/* ‚ûï ADD */
window.add = function(produto, qtd) {
  const item = selecionados.find(i => i.produto === produto);
  if (item) item.quantidade += qtd;
  else selecionados.push({ produto, quantidade: qtd });

  salvarTemp();
  atualizarResumo();
  render(busca.value);
};

/* üóëÔ∏è REMOVER */
window.remover = function(produto) {
  selecionados = selecionados.filter(i => i.produto !== produto);
  salvarTemp();
  atualizarResumo();
  render(busca.value);
};

/* üìã RESUMO */
function atualizarResumo() {
  itens.innerHTML = "";
  resumo.classList.toggle("hidden", selecionados.length === 0);

  selecionados.forEach(i => {
    const li = document.createElement("li");
    li.innerHTML = `
      ${i.quantidade} x ${i.produto}
      <button onclick="remover('${i.produto}')">üóëÔ∏è</button>
    `;
    itens.appendChild(li);
  });

  validar();
}

function validar() {
  finalizar.disabled = !(tipo.value && colaborador.value && selecionados.length);
}

function salvarTemp() {
  localStorage.setItem("temporario", JSON.stringify(selecionados));
}

/* üöÄ SALVAR NO FIREBASE */
finalizar.onclick = async () => {
  await addDoc(collection(db, "movimentacoes"), {
    tipo: tipo.value,
    colaborador: colaborador.value,
    data: new Date(),
    itens: selecionados
  });

  localStorage.removeItem("temporario");

  alert("Movimenta√ß√£o salva no Firebase üî•");

  selecionados = [];
  tipo.value = "";
  colaborador.value = "";
  resumo.classList.add("hidden");
  render();
};

/* üîç EVENTOS */
busca.oninput = e => render(e.target.value);
tipo.onchange = validar;
colaborador.onchange = validar;

render();
atualizarResumo();
</script>


</body>
</html>
